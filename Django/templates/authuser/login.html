{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/auth.css' %}?v=18">
{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="glass-card auth-card">
        <h2 class="auth-title">Login</h2>
        
        <form method="post" class="auth-form" id="login-form">
            {% csrf_token %}
            
            {% if form.errors %}
            <div class="error-message" id="server-error">
                <p>Your username or password is incorrect. Please try again.</p>
            </div>
            {% endif %}
            
            <div class="form-group">
                <label for="id_username">Username</label>
                <div class="input-with-icon">
                    <i class="fas fa-user"></i>
                    <input type="text" name="username" id="id_username" required>
                </div>
            </div>
            
            <div class="form-group">
                <label for="id_password">Password</label>
                <div class="input-with-icon">
                    <i class="fas fa-lock"></i>
                    <input type="password" name="password" id="id_password" required>
                    <button type="button" class="toggle-password" onclick="togglePassword('id_password', this)">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>
            
            <button type="submit" class="neon-btn primary-btn">Login</button>
        </form>
        
        <div class="auth-links">
            <p>Don't have an account? <a href="{% url 'authuser:signup' %}" class="neon-text">Sign Up</a></p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/auth.js' %}"></script>
<script>
function togglePassword(inputId, button) {
    const input = document.getElementById(inputId);
    const icon = button.querySelector('i');
    
    if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}

// Show server error as toast if present
document.addEventListener('DOMContentLoaded', function() {
    const serverError = document.getElementById('server-error');
    if (serverError) {
        showToast('Your username or password is incorrect. Please try again.', 'error', 'Login Failed');
        serverError.style.display = 'none'; // Hide the original error message
    }
});

// Form validation
document.querySelector('.auth-form').addEventListener('submit', function(e) {
    const username = document.getElementById('id_username').value.trim();
    const password = document.getElementById('id_password').value;
    
    if (!username) {
        e.preventDefault();
        showToast('Please enter your username', 'error', 'Validation Error');
        document.getElementById('id_username').focus();
        return false;
    }
    
    if (!password) {
        e.preventDefault();
        showToast('Please enter your password', 'error', 'Validation Error');
        document.getElementById('id_password').focus();
        return false;
    }
    
    if (password.length < 6) {
        e.preventDefault();
        showToast('Password must be at least 6 characters long', 'error', 'Validation Error');
        document.getElementById('id_password').focus();
        return false;
    }
    
    // Only show loading state if validation passed
    const submitBtn = this.querySelector('button[type="submit"]');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';
});
</script>
{% endblock %}